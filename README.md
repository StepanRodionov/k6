# k6

Описание инструмента

## Запуск

## Запуск локально

## Профили нагрузки

Доступные профили нагрузки, сценарии и код на js

## Написание своих расширений

### Вводные

Для разработки своих расширений (плагинов) необходимо установить инструмент [xk6](https://github.com/grafana/xk6). 
Это легко сделать, пользуясь официальной документацией. После чего вы сможете собирать бинарник k6 с внешними модулями или своим собственным.

Подробнее вот тут: https://k6.io/docs/extensions/guides/build-a-k6-binary-with-extensions/

> Если у вас возникают проблемы с запуском xk6, выполните в терминале `export PATH=$PATH:$(go env GOPATH)/bin`. 
> Также необходимо включить модули go - `export GO111MODULE="on"`, а еще в проекте созданы файлы go.mod и load.go, без них не запускается
> 
> Вполне возможно, что все шаги выше нафиг не нужны при грамотной настройке

Пример плагина можно найти в папке ./plugins/demo . Пример сборки с локальным модулем demo и внешним модулем sql в Makefile. 
Там же пример запуска локально собранного бинарника

### Как писать свои плагины?

TODO - рекомендации по написанию своих модулей.
Пример кода модуля от k6 - https://github.com/grafana/xk6-sql/blob/master/sql.go

### Как работать с образами в pipeline

Собираем image при помощи Dockerfile из проекта, результатом запуска которого будет образ с готовым бинарником, содержащим оба этих плагина. 
Образ необходимо запушить в registry. Пример действий:

```bash
docker build .
# writing image sha256:8f958d901369be800cb7dcad2752129d5a5ac47c0bd737be6d2d7f196ea98093
docker tag 8f958d901369 registry.ru/namespace/project:tag
docker push registry.ru/namespace/project:tag
```

Сейчас этот образ можно получить в hub.docker.com как rodionoff/xk6:^0.9

Что необходимо сделать дальше:
- добавить стадию сборки образа в pipeline
- пушить образ в registry вашей организации
- скачивать его на стадии запуска нагруза и запускать на нем


